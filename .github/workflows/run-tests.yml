name: テストをローカルで実行

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: コードをチェックアウト
        uses: actions/checkout@v4

      - name: Pythonをセットアップ
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      - name: 依存関係をインストール
        run: |
          python -m venv venv
          source venv/bin/activate
          pip install -r python/requirements.txt
          pip install -r python/requirements-dev.txt

      - name: 翻訳ファイルを更新
        run: |
          source venv/bin/activate
          bash python/apisource/translations/update_translations.sh

      - name: テストを実行
        run: |
          source venv/bin/activate
          export PYTHONPATH=python/apisource
          pytest python/apisource/tests

      - name: テスト結果のログを表示
        run: |
          cat python/apisource/logs/access.log
          cat python/apisource/logs/error.log